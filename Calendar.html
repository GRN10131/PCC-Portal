<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shared Calendar</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
  margin: 0;
  background: #0f172a;
  color: #e5e7eb;
  font-family: system-ui, sans-serif;
}
header {
  padding: 16px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
button {
  background: #4f46e5;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 6px;
  cursor: pointer;
}
button:hover { opacity: 0.9; }
#calendar {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  padding: 16px;
}
.day {
  background: #020617;
  border-radius: 8px;
  padding: 8px;
  min-height: 100px;
}
.day h4 {
  margin: 0;
  font-size: 12px;
  color: #94a3b8;
}
.event {
  background: rgba(255,255,255,0.05);
  border-left: 4px solid;
  padding: 4px 6px;
  margin-top: 6px;
  font-size: 12px;
  border-radius: 4px;
}
footer {
  text-align: center;
  padding: 12px;
  font-size: 12px;
  color: #94a3b8;
}
</style>
</head>
<body>

<header>
  <button id="prev">◀</button>
  <h2 id="title"></h2>
  <button id="next">▶</button>
</header>

<div id="calendar"></div>

<footer>
  Events are submitted via Microsoft Forms and shared for everyone
</footer>

<script>
const API_URL = "https://default71f8d9a33347400da852d217cf3d65.4e.environment.api.powerplatform.com/powerautomate/automations/direct/workflows/8091adb2e0f64685af84f6f6087101bb/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=rFtzRTChPqE-k4bEn0WIXt1Ww4fzGSJkxsAeQXK0SEw";

let current = new Date();

function iso(d) {
  return d.toISOString().slice(0,10);
}

function monthTitle(d) {
  return d.toLocaleString(undefined, { month: "long", year: "numeric" });
}

async function fetchEvents() {
  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: "{}"
    });
    if (!res.ok) throw new Error();
    return await res.json();
  } catch {
    return [];
  }
}

async function render() {
  document.getElementById("title").textContent = monthTitle(current);
  const cal = document.getElementById("calendar");
  cal.innerHTML = "";

  const events = await fetchEvents();

  const first = new Date(current.getFullYear(), current.getMonth(), 1);
  const start = new Date(first);
  start.setDate(start.getDate() - start.getDay());

  for (let i = 0; i < 42; i++) {
    const d = new Date(start);
    d.setDate(start.getDate() + i);

    const cell = document.createElement("div");
    cell.className = "day";
    cell.innerHTML = `<h4>${d.getDate()}</h4>`;

    const dayEvents = events.filter(e => e.date === iso(d));
    dayEvents.forEach(ev => {
      const el = document.createElement("div");
      el.className = "event";
      el.style.borderColor = ev.color || "#4f46e5";
      el.textContent = `${ev.time || ""} ${ev.title}`;
      cell.appendChild(el);
    });

    cal.appendChild(cell);
  }
}

document.getElementById("prev").onclick = () => {
  current.setMonth(current.getMonth() - 1);
  render();
};

document.getElementById("next").onclick = () => {
  current.setMonth(current.getMonth() + 1);
  render();
};

render();
</script>

</body>
</html>
